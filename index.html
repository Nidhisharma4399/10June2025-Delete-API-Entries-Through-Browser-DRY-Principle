<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <title>www.instagramloginpage.com</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous"/>
        <link rel="preconnect" href="https://fonts.googleapis.com"/>
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
        <link href="https://fonts.googleapis.com/css2?family=Lobster&display=swap" rel="stylesheet"/>
        <style>
            h1{
                text-align: center;
                color:dodgerblue;
                font-family: "Lobster", sans-serif;
                font-weight: 400;
                font-style: normal;
                font-size: 60px;
                margin-top: 5px;
            }
            body{
                background-color: #121212;
                justify-content: center;
            }
            .container{
                border-radius: 5px;
            }
            form{
                font-family: Georgia, 'Times New Roman', Times, serif;
                font-size: 20px;
            }
            table{
                text-align: center;
            }
            p{
                text-align: center;
                color:white;
            }
    
        </style>
    </head>
    <body>
        <h1>Instagram</h1>
        <form method="POST" action= 'http://localhost:1337/api/details'>
            <div class="container">
                <div class="row mt-5">
                    <div class=" col-4 offset-4">
                        <input autofocus type="text" name="Username" class="form-control" placeholder="Enter Username"/>
                        </br>
                        <div class="d-grid mt-3">
                             <input type="submit" class="btn btn-primary" value="Login"  onclick="getOutput(event)" />
                        </div>
                    </div>
                </div>
            </div>
        </form>
        </br>
        <p>-----------------------Or---------------------------</p>
        <div class="row mt-5">
            <div class=" col-4 offset-4">
                <table class=table table-success id="MyTable">
                    <thead>
                        <tr>
                            <th>Username</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody  class="table-success">
                        <tr>
                            <td >User1</td>
                            <td>
                                <button type="button" onclick="console.log(`User Saved`)" class="btn btn-success btn-sm">View</button>
                                <button type="button" class="btn btn-info btn-sm" onclick="prompt('Type the Correction') ">Edit</button>
                                <button type="button" class="btn btn-danger btn-sm" onclick="alert('Info Deleted')">Delete</button>
                            </td>
                        </tr>
                    </tbody>
                    <tfoot></tfoot>
                </table>
        
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        let BASE_URL ="http://localhost:1337"; //to avoid repeatation of code (DRY Principle)
        var xhr = new XMLHttpRequest();

        // Function definition - called on form submission
        function getOutput(e) {
            e.preventDefault(); // Prevent page reloading

             console.log("User Stored");
             console.log(e.target.closest('form')); // Traversing up to the form
             console.log(e.target.closest('form').querySelector('input[name="Username"]').value); // Traversing down to get value

            // Get the Username value
            let Username = e.target.closest('form').querySelector('input[name="Username"]').value;

            // Convert JS object to JSON string
            let data = JSON.stringify({
                data: {
                    "Username": `${Username}`
                }
            });

            // Open POST request to local Strapi endpoint
            xhr.open("POST", `${BASE_URL}/api/details`, true);
            // xhr.open("POST", "https://647f-2401-4900-7ce0-cb50-d107-d99b-44d9-753a.ngrok-free.app/api/details", true);

            xhr.setRequestHeader("Content-Type", "application/json"); // Set content type header

            xhr.onreadystatechange = function () {
                if (this.readyState == 4 && (this.status == 201 || this.status == 200)) {
                    Swal.fire({
                        title: "Your Data is Stored Successfully!",
                        text: "You clicked the button!",
                        icon: "success"
                    });
                }
            };

            // Send data to Strapi
            xhr.send(data);

             console.log(data);
             console.log("User Stored successfully");
        } 
    </script>

    <script>
        // Read operations with Ajax (XMLHttpRequest
        // Open GET request to local Strapi endpoint

        xhr.open("GET", `${BASE_URL}/api/details`, true); //by string Interpolation

        xhr.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                 console.log(this.responseText);
                 console.log(JSON.parse(this.responseText));

                let json = JSON.parse(this.responseText);

                // Access the table by ID
                let tbody = document.getElementById('MyTable').querySelector('tbody');
                 console.log(tbody);
                tbody.innerHTML = '';

                // Populate table with data
                for (let variable of json.data) {
                     console.log(variable.Username);

                    tbody.innerHTML += `
                        <tr>
                            <td>${variable.Username}</td> 
                            <td>
                                 <button type="button" class="btn btn-success btn-sm ">View</button>
                                 <button type="button" class="btn btn-info btn-sm">Edit</button>
                                 <button type="button" class="btn btn-danger btn-sm" onclick="deleteElement(this)"  data-del-Id=${variable.documentId}> Delete</button>
                            </td>
                        </tr>`;
                }
            }
        };
          xhr.send();

        //Function calling 
        //function calling is a one time process
        function deleteElement(e){//formal argument
            console.log(e);
            const delId = e.getAttribute('data-del-Id');
            //const delId = e.dataset.delId;
             console.log("Delete Id :" , delId)
            // Send DELETE request to Server
             console.log("I am inside deleteElement Function");

            Swal.fire({
                title: "Are you sure?",
                text: "You won't be able to revert this!",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#3085d6",
                cancelButtonColor: "#d33",
                confirmButtonText: "Yes, delete it!"
            }).then((result) => {
                    if (result.isConfirmed) {
                         xhr.open("DELETE",`${BASE_URL}/api/details/${delId}`); //by string interpolation
                         xhr.send();
                         e.closest('tr').remove();//to remove the entry from browser
                         console.log("File Is Deleted....!!!");

                         Swal.fire({
                         title: "Deleted!",
                         text: "Your file has been deleted.",
                         icon: "success"
                        });
                       
                    }
            });
         
        }

    </script>
</html>